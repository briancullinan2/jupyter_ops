<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>ask llm to generalize categories</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    html {
      padding: 0;
      margin: 0;
    }

    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
      padding: 10px;
    }

    body {
      padding: 0 0 0 200px;
      margin: 0;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <h3><a href="../llama/index.html">llama</a></h3>
    <a href="./search_llama.html">search llama</a>
<br /><br />
<a href="./ask_llm_about_categories.html">ask llm about categories</a>
<br /><br />
<a href="./ask_llm_to_generalize_categories.html">ask llm to generalize categories</a>
<br /><br />
<a href="./ask_llm_for_a_shorter_list_of_categories.html">ask llm for a shorter list of categories</a>
<br /><br />
<a href="./ask_llm_about_functions.html">ask llm about functions</a>
<br /><br />
<a href="./ask_llm_about_code.html">ask llm about code</a>
<br /><br />
<a href="./ask_llm_about_notebooks.html">ask llm about notebooks</a>
<br /><br />
<a href="./ask_llm_to_summerize.html">ask llm to summerize</a>
<br /><br />
<a href="./store_llama_function.html">store llama function</a>
<br /><br />
<a href="./store_all_notebook_llm_functions.html">store all notebook llm functions</a>
<br /><br />
<a href="./create_llm_session.html">create llm session</a>
<br /><br />

  </nav>
  <header>
    <a href="../llama/index.html">llama</a> | <a href="./ask_llm_about_categories.html">ask llm about categories</a> | <a href="./ask_llm_for_a_shorter_list_of_categories.html">ask llm for a shorter list of categories</a> | <a href="../../search.html">Search</a>
  </header>

  <p>The <code>askLlamaGeneralizeCategories</code> function takes an optional list of categories as input, generates a shorter list by asking the LLM to generalize, and recursively optimizes the list to a maximum of 100 items. The function also updates the <code>functionCache</code> object by asking the LLM to generalize categories for each function in the cache, if the <code>update</code> flag is set.</p>
<h2>Run example</h2>

<pre language="bash"><code>npm run import -- "ask llm to generalize categories"</code></pre><h1>ask llm to generalize categories</h1>



<pre class="javascript"><code>const { functionCache } = importer.import("<a href="../../Databases/caches/cache_rpc_functions_with_llm_descriptions.html">cache rpc functions with llm descriptions</a>")
const { askLlamaAboutFunctions } = importer.import("<a href="../../Algorithms/llama/ask_llm_about_functions.html">ask llm about functions</a>")
const { storeLlamaFunction } = importer.import("<a href="../../Algorithms/llama/store_llama_function.html">store llama function</a>")
const { askLlamaToGeneralizeAll } = importer.import("<a href="../../Algorithms/llama/ask_llm_for_a_shorter_list_of_categories.html">ask llm for a shorter list of categories</a>")

async function askLlamaGeneralizeCategories(categories) {
  let update = false
  let keys = Object.keys(functionCache)
  if(!categories) {
    categories = keys.map(k =&gt; functionCache[k].categories)
      .filter((a, i, arr) =&gt; a &amp;&amp; arr.indexOf(a) == i &amp;&amp; !a.includes('\n'))
    update = true
  }

  if(categories.length == 0) {
    return []
  }

  let uniqueValues = await askLlamaToGeneralizeAll(categories)
  console.log(uniqueValues)

  if(uniqueValues.length &gt; 100) {
    uniqueValues = (await askLlamaGeneralizeCategories(uniqueValues))
      .filter((a, i, arr) =&gt; arr.indexOf(a) == i)
  }

  if(update) {
    let convertedList = []
    for(let i = 0; i &lt; keys.length; i++) {
      let newCategory = await askLlamaAboutFunctions(functionCache[keys[i]].categories, uniqueValues, [], true)
      if(newCategory) {
        storeLlamaFunction(keys[i], functionCache[keys[i]].mtime, 
          functionCache[keys[i]].exports, functionCache[keys[i]].description, 
          functionCache[keys[i]].summary, functionCache[keys[i]].categories, newCategory)
      }
      convertedList[i] = newCategory
    }
    console.log(convertedList)
  }

  return uniqueValues
}

module.exports = {
  askLlamaGeneralizeCategories
}
</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="../../mergehtml.js"></script>

<script>
hljs.addPlugin(mergeHTMLPlugin);
hljs.highlightAll();
</script>

<h2>Code Breakdown</h2>
<h3>Imported Functions</h3>
<p>The code imports four functions from an <code>importer</code> module:</p>
<ul>
<li><code>functionCache</code>: an object cache of functions with LLM descriptions</li>
<li><code>askLlamaAboutFunctions</code>: a function to ask the LLM about a set of functions</li>
<li><code>storeLlamaFunction</code>: a function to store a LLM function</li>
<li><code>askLlamaToGeneralizeAll</code>: a function to ask the LLM for a shorter list of categories</li>
</ul>
<h3><code>askLlamaGeneralizeCategories</code> Function</h3>
<h4>Purpose</h4>
<p>The <code>askLlamaGeneralizeCategories</code> function takes an optional <code>categories</code> array as input and returns a shorter list of categories.</p>
<h4>Flow</h4>
<ol>
<li>If <code>categories</code> is not provided, it is generated from the <code>functionCache</code> object by:
<ul>
<li>Mapping over the cache keys and their corresponding categories</li>
<li>Filtering out empty or duplicate categories</li>
<li>Setting <code>update</code> flag to <code>true</code></li>
</ul></li>
<li>If <code>categories</code> is empty, return an empty array</li>
<li>Call <code>askLlamaToGeneralizeAll</code> to get a shorter list of categories from the LLM</li>
<li>If the returned list has more than 100 items, recursively call <code>askLlamaGeneralizeCategories</code> on the result to further reduce the list</li>
<li>If the <code>update</code> flag is set, iterate over the original <code>functionCache</code> keys and:
<ul>
<li>Ask the LLM to generalize the categories for each function using the updated <code>uniqueValues</code> list</li>
<li>Store the updated function in the <code>functionCache</code> object</li>
</ul></li>
<li>Return the final <code>uniqueValues</code> list</li>
</ol>
<h4>Export</h4>
<p>The <code>askLlamaGeneralizeCategories</code> function is exported as a module.</p>

</body>

</html>