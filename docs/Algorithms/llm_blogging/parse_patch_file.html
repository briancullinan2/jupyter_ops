<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>parse patch file</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    html {
      padding: 0;
      margin: 0;
    }

    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
      padding: 10px;
    }

    body {
      padding: 0 0 0 200px;
      margin: 0;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <h3><a href="../llm_blogging/index.html">llm blogging</a></h3>
    <a href="./blog_about_code.html">blog about code</a>
<br /><br />
<a href="./parse_patch_file.html">parse patch file</a>
<br /><br />
<a href="./TODO__summerize_file_changes__downloads_try_to_infer_purpose__use_file_watcher_install_time_machine_.html">TODO: summerize file changes, downloads try to infer purpose, use file watcher install time machine  i version my entire disk</a>
<br /><br />

  </nav>
  <header>
    <a href="../llm_blogging/index.html">llm blogging</a> | <a href="./blog_about_code.html">blog about code</a> | <a href="./TODO__summerize_file_changes__downloads_try_to_infer_purpose__use_file_watcher_install_time_machine_.html">TODO: summerize file changes, downloads try to infer purpose, use file watcher install time machine  i version my entire disk</a> | <a href="../../search.html">Search</a>
  </header>

  <p>The <code>parsePatch</code> function takes a patch file as input, parses its content, and returns an object containing information about added and deleted lines across all files, along with the total number of additions and deletions. The function uses line type checks to determine the type of each line and update the corresponding object accordingly.</p>
<h2>Run example</h2>

<pre language="bash"><code>npm run import -- "parse patch file"</code></pre><h1>parse patch file</h1>



<pre class="javascript"><code>const fs = require("fs");

function parsePatch(patchFile) {
    let patchContent = patchFile
    if(fs.existsSync(patchFile)) {
        patchContent = fs.readFileSync(patchFile, "utf-8");
    }
    const lines = patchContent.split("\n");

    let summary = {
        files: {},
        totalAdditions: 0,
        totalDeletions: 0
    };

    let currentFile = null;

    lines.forEach(line =&gt; {
        console.log(line)
        if (line.startsWith("+++ b/")) {
            currentFile = line.replace("+++ b/", "").trim();
            summary.files[currentFile] = { additions: [], deletions: [] };
        } else if (line.startsWith("+") &amp;&amp; !line.startsWith("+++")) {
            const addedLine = line.slice(1).trim(); // Remove leading '+' and trim
            summary.files[currentFile].additions.push(addedLine);
            summary.totalAdditions++;
        } else if (line.startsWith("-") &amp;&amp; !line.startsWith("---")) {
            const deletedLine = line.slice(1).trim(); // Remove leading '+' and trim
            summary.files[currentFile].deletions.push(deletedLine);
            summary.totalDeletions++;
        } else if (line.startsWith('@')) {

        } else if (line.startsWith('diff')) {

        } else if (line.startsWith('index')) {

        } else if (!line.startsWith("---")) {
            const addedLine = line.slice(1).trim(); // Remove leading '+' and trim
            summary.files[currentFile].additions.push(addedLine);
        }
    });

    return summary;
}

module.exports = parsePatch

</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>

<script>hljs.highlightAll();</script>

<p><strong>Function Description:</strong></p>
<pre><code class="language-markdown"># parsePatch Function
## Purpose
Parses a patch file and extracts information about added and deleted lines.

## Parameters
- `patchFile`: The path to the patch file to be parsed.

## Returns
- An object containing the following information:
  - `files`: An object where each key is a file name and each value is another object containing arrays for added and deleted lines.
  - `totalAdditions`: The total number of added lines across all files.
  - `totalDeletions`: The total number of deleted lines across all files.
</code></pre>
<p><strong>Import Statement:</strong></p>
<pre><code class="language-javascript">const fs = require(&quot;fs&quot;);
</code></pre>
<p><strong>Function Body:</strong></p>
<pre><code class="language-markdown"># Function Body
## Check if Patch File Exists
- Check if the patch file exists using `fs.existsSync(patchFile)`.
- If the file exists, read its content using `fs.readFileSync(patchFile, &quot;utf-8&quot;)`.

## Initialize Variables
- Initialize an object `summary` to store the extracted information.
- Initialize a variable `currentFile` to keep track of the current file being processed.

## Process Each Line in the Patch File
- Iterate over each line in the patch file using `lines.forEach(line =&gt; {... })`.
- Check the line type and update the `summary` object accordingly.
</code></pre>
<p><strong>Line Type Checks:</strong></p>
<pre><code class="language-markdown"># Line Type Checks
- If the line starts with `+++ b/`, it indicates the start of a new file.
- If the line starts with `+` and does not start with `+++`, it indicates an added line.
- If the line starts with `-` and does not start with `---`, it indicates a deleted line.
- If the line starts with `@`, it is ignored (no action is taken).
- If the line starts with `diff`, it is ignored (no action is taken).
- If the line starts with `index`, it is ignored (no action is taken).
- If the line does not start with `---` and is not an added line, it is assumed to be an added line.
</code></pre>
<p><strong>Return Statement:</strong></p>
<pre><code class="language-javascript">return summary;
</code></pre>
<p><strong>Export Statement:</strong></p>
<pre><code class="language-javascript">module.exports = parsePatch;
</code></pre>

</body>

</html>