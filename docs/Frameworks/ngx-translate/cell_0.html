

<pre><code>var glob = require('glob');

var translateRegex = (/[\{"]([^><"]*?)\s*\|\s*translate\s*(:\s*[^><"\}]*?)?["\}]/ig);

function getTranslations(project) {
    var files = glob.sync('**/*component.html', {
        ignore: '**/temp-demo-pages/**',
        cwd: project
    });
    var translations = files.map((f, i) => {
        var html = fs.readFileSync(path.join(cwd, f)).toString();
        let r;
        var translateStrings = [];
        while ((r = translateRegex.exec(html)) !== null) {
            translateStrings[translateStrings.length] = r[1].trim().replace(/[\'{}\s]/ig, '');
        }
        var desiredKey = f
            .replace('app/', '')
            .replace(/\//ig, '.')
            .replace('.component.html', '')
            .replace(/-/ig, '').split('.');
        desiredKey.pop();
        desiredKey = desiredKey.join('.').toUpperCase();
        var result = {};
        result[desiredKey] = translateStrings;
        return result;
    });

    var translationKeys = translations.reduce((obj, tr) => {
        var key = Object.keys(tr).pop();
        if (typeof obj[key] !== 'undefined') {
            obj[key] = obj[key].concat(tr[key]);
        } else {
            obj[key] = tr[key];
        }
        return obj;
    }, {});

    return translationKeys;
}
module.exports = getTranslations;

if(typeof $$ !== 'undefined') {
    var cwd = '/Users/briancullinan/Documents/portal/src/';
    getTranslations(cwd);
}
</code></pre>

