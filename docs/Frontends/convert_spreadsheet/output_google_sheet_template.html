<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>output google sheet template</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
    }

    body {
      padding-left: 200px;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <a href="../convert_spreadsheet/index.html">convert spreadsheet</a>
    <br /><br />
    <a href="./readme_md.html">readme.md</a>
<br /><br />
<a href="./get_sheet_purchases.html">get sheet purchases</a>
<br /><br />
<a href="./sheet_marketing_import.html">sheet marketing import</a>
<br /><br />
<a href="./filter_data_sheet_based_on_url.html">filter data sheet based on url</a>
<br /><br />
<a href="./google_sheet_template_properties.html">google sheet template properties</a>
<br /><br />
<a href="./google_sheet_layout_template.html">google sheet layout template</a>
<br /><br />
<a href="./output_google_sheet_template.html">output google sheet template</a>
<br /><br />
<a href="./find_known_routes_to_sheets.html">find known routes to sheets</a>
<br /><br />
<a href="./collect_external_content_and_resources.html">collect external content and resources</a>
<br /><br />
<a href="./collect_google_sheets_resources.html">collect google sheets resources</a>
<br /><br />
<a href="./sheet_to_web.html">sheet to web</a>
<br /><br />
<a href="./convert_sheet_helper_functions.html">convert sheet helper functions</a>
<br /><br />
<a href="./package_json.html">package.json</a>
<br /><br />

  </nav>
  <header>
    <a href="../convert_spreadsheet/index.html">convert spreadsheet</a> ${PREV} ${NEXT}
  </header>

  <p>Here is a 2-sentence summary:</p>
<p>Five functions are provided in this module: <code>safeName</code>, <code>toJSON</code>, <code>segment</code>, <code>wrapTemplate</code>, and <code>wrapTemplate</code> (exported as the main module export). The <code>wrapTemplate</code> function is the most complex, creating a wrapped HTML template with metadata and rendering it with provided properties, while the other functions perform specific string transformations and handling.</p>


<pre class="javascript"><code>var fs = require('fs');
var path = require('path');
var Mustache = require('mustache');

function safeName(val, render) {
    return render(val).replace(/[^a-z0-9\-]/ig, '-').substr(0, 40)
}

function toJSON(val, render) {
    return render(JSON.stringify(val))
}

function segment(url, val, render) {
    return url.split('/')[render(val)]
}

function wrapTemplate(path, key, html, properties) {
    properties['safeName'] = () =&gt; safeName
    properties['toJSON'] = () =&gt; toJSON
    properties['segment'] = () =&gt; segment.bind(null, path)
    var classNames = path.replace(/\//ig, ' ')
        + ' ' + (key !== path.split('/')[0] ? key : '')
        + ' ' + (properties['class'] || '')

    var domain = '';
    if(typeof properties['domain'] != 'undefined') {
        domain = properties['domain'].includes(':') ? '' : 'https://{{domain}}';
    }
    
    // automatically set title if it isn't set manually
    var result;
    if(typeof properties['title'] == 'undefined' &amp;&amp; (result = (/&lt;h1&gt;(.*)&lt;\/h1&gt;/ig).exec(html))) {
        properties['title'] = result[1];
    }
    
    var pageHtml = `
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="utf-8"&gt;
&lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"&gt;
&lt;link rel="icon" href="{{logo}}"&gt;
{{#base}}&lt;base href="/{{.}}" /&gt;{{/base}}
&lt;meta property="og:type" content="website"&gt;
&lt;meta property="og:title" content="{{title}}"&gt;
&lt;link rel="canonical" href="${domain}/${path}"&gt;
&lt;title&gt;{{title}}&lt;/title&gt;
{{#banner}}
&lt;style&gt;
body &gt; div.col-1:nth-of-type(2):before {background-image: url('{{{.}}}');}
body &gt; div.col-1:nth-of-type(2):after {background-image: url('{{{.}}}');}
&lt;/style&gt;
{{/banner}}
{{#stylesheet}}&lt;link rel="stylesheet" href="{{.}}"&gt;{{/stylesheet}}
&lt;/head&gt;
&lt;body class="${classNames}"&gt;
${html}
{{#script}}&lt;script async src="{{.}}"&gt;&lt;/script&gt;{{/script}}
&lt;/body&gt;
&lt;/html&gt;`;

    Mustache.parse(pageHtml);
    // use properties for view and for partials
    return Mustache.render(pageHtml, properties, properties);
}

module.exports = wrapTemplate;

</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>

<script>hljs.highlightAll();</script>

<p><strong>Function Breakdown</strong></p>
<h3><code>safeName(val, render)</code></h3>
<ul>
<li>Requires <code>render</code> function to transform <code>val</code></li>
<li>Returns <code>val</code> with non-alphanumeric characters replaced with hyphens and truncated to 40 characters</li>
</ul>
<h3><code>toJSON(val, render)</code></h3>
<ul>
<li>Requires <code>render</code> function to transform <code>val</code></li>
<li>Returns <code>JSON.stringify(val)</code> rendered</li>
</ul>
<h3><code>segment(url, val, render)</code></h3>
<ul>
<li>Requires <code>render</code> function to transform <code>val</code></li>
<li>Returns <code>url</code> with <code>val</code> as the index to split and retrieve from</li>
</ul>
<h3><code>wrapTemplate(path, key, html, properties)</code></h3>
<ul>
<li>Creates a wrapped HTML template with default metadata</li>
<li>Replaces non-alphanumeric characters in <code>path</code> and <code>key</code> with hyphens</li>
<li>Generates <code>classNames</code> for the <code>&lt;body&gt;</code> element</li>
<li>Sets default metadata: <code>title</code> from <code>&lt;h1&gt;</code> tag if present, <code>logo</code> and <code>base</code> if present in <code>properties</code></li>
<li>Renders the template with <code>properties</code> as data</li>
<li>Returns the rendered HTML string</li>
</ul>
<h3><code>module.exports = wrapTemplate;</code></h3>
<ul>
<li>Exports the <code>wrapTemplate</code> function as the module's main export</li>
</ul>

</body>

</html>