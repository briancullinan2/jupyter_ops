<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>update a row in google sheets</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
    }

    body {
      padding-left: 200px;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <a href="../google_sheets/index.html">google sheets</a>
    <br /><br />
    <a href="./templates_google_doc.html">templates google doc</a>
<br /><br />
<a href="./test_templates_google_sheet.html">test templates google sheet</a>
<br /><br />
<a href="./get_google_sheet_info.html">get google sheet info</a>
<br /><br />
<a href="./get_google_data_sheet.html">get google data sheet</a>
<br /><br />
<a href="./get_worksheet_rows.html">get worksheet rows</a>
<br /><br />
<a href="./test_google_data_sheet.html">test google data sheet</a>
<br /><br />
<a href="./add_row_data_google_sheet.html">add row data google sheet</a>
<br /><br />
<a href="./get_worksheet_by_name.html">get worksheet by name</a>
<br /><br />
<a href="./update_a_row_in_google_sheets.html">update a row in google sheets</a>
<br /><br />
<a href="./test_google_sheet_add_row.html">test google sheet add row</a>
<br /><br />
<a href="./authorize_sheets_api.html">authorize sheets api</a>
<br /><br />

  </nav>
  <header>
    <a href="../google_sheets/index.html">google sheets</a> ${PREV} ${NEXT}
  </header>

  <p>The <code>updateRow</code> function updates a specific row in a Google Sheet based on a matching condition, utilizing helper functions for data formatting and range calculation. It leverages the Google Sheets API to perform the update and returns the modified row data.</p>


<pre class="javascript"><code>var util = require('util');
var importer = require('../Core');
var getRows = importer.import('get worksheet rows');
var authorizeSheets = importer.import('authorize sheets api');
var getSheetByName = importer.import('get worksheet by name');

var getOrderedValues = (columns, rowData) => ({
    // Google sheets API, NULL means don't write value in range, as opposed to "" which clears
    values: [columns.map(c => typeof rowData[c] === 'undefined'
                         ? null
                         : rowData[c])]
})

var getRange = (title, columns, match, rows) => {
    var row = rows.filter(r => match(columns.reduce((acc, c, i) => (acc[c] = r[i], acc), {}), r))[0];
    // if no match, add it
    var index = (rows.indexOf(row) + 1) || (rows.length + 1);
    var range = `'${title}'!A${index}:${String.fromCharCode(65 + columns.length - 1)}${index}`;
    return range;
}

function updateRow(link, match, updateRow, page) {
    var sheets, sheet;
    
    return authorizeSheets()
        .then(s => (sheets = s, getSheetByName(link, page)))
        .then(sh => (sheet = sh, getRows(link, sheet)))
        .then(rows => {
            // if passing an array, just use that
            var columns = typeof updateRow.length != 'undefined'
                ? new Array(updateRow.length)
                : rows[0];
        
            var range = getRange(sheet.properties.title, columns, match, rows);
        
            console.log(`updating range ${range} ${columns}`);
            return sheets.spreadsheets.values.update({
                spreadsheetId: sheet.spreadsheetId,
                range: range,
                valueInputOption: 'RAW',
                resource: getOrderedValues(columns, updateRow)
            })
        })
        .then(() => updateRow)
}

module.exports = updateRow;

</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>

<script>hljs.highlightAll();</script>

<p>This code defines a function <code>updateRow</code> that updates a specific row in a Google Sheet based on a matching condition.</p>
<p>Here's a breakdown:</p>
<ol>
<li><p><strong>Imports:</strong> It imports necessary modules for interacting with Google Sheets, including <code>authorizeSheets</code>, <code>getSheetByName</code>, and <code>getRows</code>.</p></li>
<li><p><strong>Helper Functions:</strong></p>
<ul>
<li><code>getOrderedValues</code>: Formats data into a format suitable for the Google Sheets API.</li>
<li><code>getRange</code>: Determines the range to update based on the worksheet title, columns, matching criteria, and existing rows.</li>
</ul></li>
<li><p><strong><code>updateRow</code> Function:</strong></p>
<ul>
<li><strong>Authorization and Sheet Retrieval:</strong> It first authorizes access to the Google Sheets API and retrieves the specified worksheet.</li>
<li><strong>Row Data Retrieval:</strong> It fetches the rows from the worksheet.</li>
<li><strong>Column Determination:</strong> It determines the columns to update based on the input <code>updateRow</code> (either an array of column names or a single row object).</li>
<li><strong>Range Calculation:</strong> It calculates the range to update using the <code>getRange</code> function.</li>
<li><strong>API Update:</strong> It uses the Google Sheets API to update the specified range with the provided data.</li>
</ul></li>
<li><p><strong>Return Value:</strong> It returns the updated row data.</p></li>
</ol>

</body>

</html>