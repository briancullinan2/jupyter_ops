<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Cell 6</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    html {
      padding: 0;
      margin: 0;
    }

    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
      padding: 10px;
    }

    body {
      padding: 0 0 0 200px;
      margin: 0;
    }

    .gold pre code,
    .gold pre code span,
    .gold code pre,
    .gold code pre span {
      color: gold;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <h3><a href="../orchestration/index.html">orchestration</a></h3>
    <a href="./resize_selenium_window.html">resize selenium window</a>
<br /><br />
<a href="./only_one_window.html">only one window</a>
<br /><br />
<a href="./tile_selenium_chrome_windows.html">tile selenium chrome windows</a>
<br /><br />
<a href="./get_all_session_and_window_urls.html">get all session and window urls</a>
<br /><br />
<a href="./send_a_joke.html">send a joke</a>
<br /><br />
<a href="./send_facebook_thanks.html">send facebook thanks</a>
<br /><br />
<a href="./cell_6.html">Cell 6</a>
<br /><br />
<a href="./clean_up_old_selenium_sessions.html">clean up old selenium sessions</a>
<br /><br />
<a href="./screenshot_all_sessions.html">screenshot all sessions</a>
<br /><br />
<a href="./cell_9.html">Cell 9</a>
<br /><br />

  </nav>
  <header>
    <a href="../orchestration/index.html">orchestration</a> | <a href="./send_facebook_thanks.html">send facebook thanks</a> | <a href="./clean_up_old_selenium_sessions.html">clean up old selenium sessions</a> | <a href="../../search.html">Search</a>
  </header>

  <p>The code imports a module named <code>Core</code> and a function named <code>selenium cell</code> from it, which is used to interact with the Selenium cell. It also defines an array of Facebook message URLs and includes a TODO comment to replace the current implementation with RPC commands.</p>
<h1>Cell 6</h1>



<pre class="javascript"><code>var importer = require('../Core');
var runSeleniumCell = importer.import("<a href="../../Selenium/webdriver/selenium_client.html">selenium cell</a>");

// TODO: replace with rpc commands

var friends = [
    'https://www.facebook.com/messages/t/patti.caudill',
    'https://www.facebook.com/messages/t/andrei.darie.5',
    'https://www.facebook.com/messages/t/setha.vanderhoof',
    /*
    'https://www.facebook.com/photo.php?fbid=10153492726971668',
    'https://www.facebook.com/messages/t/Lloydster4',
    'https://www.facebook.com/messages/t/jessegill',
    'https://www.facebook.com/messages/t/lisa.potter.7140',
    'https://www.facebook.com/messages/t/StevenLockhart123',
    'https://www.facebook.com/messages/t/lidia.ws.7',
    'https://www.facebook.com/messages/t/corinne.cullinan',
    'https://www.facebook.com/messages/t/andreas.stylianou.98',
    'https://www.facebook.com/messages/t/robert.holweger',
    'https://www.facebook.com/messages/t/tintin.katy512',
    'https://www.facebook.com/messages/t/greg.maserati.7',
    'https://www.facebook.com/messages/t/scott.johnson.31149359',
    'https://www.facebook.com/messages/t/railhunk',
    'https://www.facebook.com/messages/t/jeff.coffman.92',
    'https://www.facebook.com/messages/t/robert.holweger',
    'https://www.facebook.com/messages/t/100015169534875',
    'https://www.facebook.com/messages/t/chase.mcvey.9',
    'https://www.facebook.com/messages/t/ryan.raub',
    'https://www.facebook.com/messages/t/brian.harris.01',
    'https://www.facebook.com/messages/t/borikoni',
    'https://www.facebook.com/messages/t/tim.bangert.3',
    'https://www.facebook.com/messages/t/jsims730',
    'https://www.facebook.com/messages/t/Ryan-A-Stoffko-1784292651894577',
    'https://www.facebook.com/messages/t/sonu.karve.94',
    'https://www.facebook.com/messages/t/jason.hornack',
    'https://www.facebook.com/messages/t/BumpyJonson',
    'https://www.facebook.com/messages/t/frank.vitale01',
    'https://www.facebook.com/messages/t/jeff.kalina.79',
    'https://www.facebook.com/messages/t/demi.s.jiang',
    'https://www.facebook.com/messages/t/stephen.baier',
    'https://www.facebook.com/messages/t/mietusmm',
    'https://www.facebook.com/messages/t/chris.huie.14',
    'https://www.facebook.com/messages/t/vitali.kaush',
    'https://www.facebook.com/messages/t/FJoeAZ',
    'https://www.facebook.com/messages/t/SusanAgresta',
    'https://www.facebook.com/messages/t/andrew.s.mcvey.3',
    'https://www.facebook.com/messages/t/faulkner.shane',
    'https://www.facebook.com/messages/t/100013570236133',
    'https://www.facebook.com/messages/t/ryan.stoffko',
    'https://www.facebook.com/messages/t/6212130467169267713',
    'https://www.facebook.com/messages/t/joanna.street24',
    'https://www.facebook.com/messages/t/stephanie.desertgirl',
    'https://www.facebook.com/messages/t/vladimir.zuzukin',
    'https://www.facebook.com/messages/t/ScientificMaster.Me',
    'https://www.facebook.com/messages/t/maungkyarphyuu',
    'https://www.facebook.com/messages/t/maciejc',
    'https://www.facebook.com/messages/t/travis.hudson.507',
    'https://www.facebook.com/messages/t/ryan.raub',
    'https://www.facebook.com/messages/t/jennifer.reaves.58',
    'https://www.facebook.com/messages/t/jeff.kalina.79',
    'https://www.facebook.com/messages/t/talbert.tso',
    'https://www.facebook.com/messages/t/greg.maserati.7',
    'https://www.facebook.com/messages/t/katya.geissler',
    'https://www.facebook.com/messages/t/100008264283932',
    'https://www.facebook.com/messages/t/frederick.murphy.56',
    'https://www.facebook.com/messages/t/april.knapp.13',
    'https://www.facebook.com/messages/t/carisa.knight6000',
    'https://www.facebook.com/messages/t/Jakebot12',
    'https://www.facebook.com/messages/t/nathaniel.ellingson.3',
    'https://www.facebook.com/messages/t/4dumbdogs',
    'https://www.facebook.com/messages/t/marv.thornsberry',
    'https://www.facebook.com/messages/t/benjamin.maynard.9',
    'https://www.facebook.com/messages/t/enzo.armetta',
    'https://www.facebook.com/messages/t/MCChopper',
    'https://www.facebook.com/messages/t/suzi.abramsonjohnson',
    'https://www.facebook.com/messages/t/chris.paschall.37',
    'https://www.facebook.com/messages/t/tynababbit15',
    'https://www.facebook.com/messages/t/colleen.k.cullinan',
    'https://www.facebook.com/messages/t/ivana.vilotic.7',
    'https://www.facebook.com/messages/t/mark.camacho.50',
    'https://www.facebook.com/messages/t/fellchase2.0',
    'https://www.facebook.com/messages/t/mietusmm',
    'https://www.facebook.com/messages/t/lemcvey',
    'https://www.facebook.com/messages/t/100010177366596',
    'https://www.facebook.com/messages/t/julie.davis.792',
    'https://www.facebook.com/messages/t/tblondi',
    'https://www.facebook.com/messages/t/JesusAndTheAngels',
    'https://www.facebook.com/messages/t/callie.m.cullinan',
    'https://www.facebook.com/messages/t/Valorie.PONY.Teter',
    'https://www.facebook.com/messages/t/RogerRohweder',
    'https://www.facebook.com/messages/t/caudill.619',
    'https://www.facebook.com/messages/t/1623650947',
    'https://www.facebook.com/messages/t/cindy.huelskampjudy',
    'https://www.facebook.com/messages/t/100015169534875',
    'https://www.facebook.com/messages/t/brian.daviesjones.3',
    'https://www.facebook.com/messages/t/100005972775784',
    'https://www.facebook.com/messages/t/diane.weaver.948',
    'https://www.facebook.com/messages/t/jason.hornack',
    'https://www.facebook.com/messages/t/chase.mcvey.9',
    'https://www.facebook.com/messages/t/100006728686581',
    'https://www.facebook.com/messages/t/100013570236133',
    'https://www.facebook.com/messages/t/6212130467169267713',
    'https://www.facebook.com/messages/t/tim.bangert.3',
    'https://www.facebook.com/messages/t/katie.hiro',
    'https://www.facebook.com/messages/t/armando.moreno.90',
    'https://www.facebook.com/messages/t/john.kaniecki.3',
    'https://www.facebook.com/messages/t/chris.cullinan.792',
    'https://www.facebook.com/messages/t/ryan.stoffko',
    'https://www.facebook.com/messages/t/joanna.street24',
    'https://www.facebook.com/messages/t/stephanie.desertgirl',
    'https://www.facebook.com/messages/t/rohwedernt',
    'https://www.facebook.com/messages/t/david.earl.smith',
    'https://www.facebook.com/messages/t/lemcvey',
    'https://www.facebook.com/messages/t/teresa.cvach',
    'https://www.facebook.com/messages/t/firealwaysworks',
    'https://www.facebook.com/messages/t/crystaldgraziano',
    'https://www.facebook.com/messages/t/faulkner.shane',
    'https://www.facebook.com/messages/t/colleen.k.cullinan',
    'https://www.facebook.com/messages/t/lemcvey',
    'https://www.facebook.com/messages/t/james.cullinan.315',
    'https://www.facebook.com/messages/t/jaimeneufer',
    'https://www.facebook.com/messages/t/nathaniel.ellingson.3',
    'https://www.facebook.com/messages/t/aneesh.karve',
    'https://www.facebook.com/messages/t/robert.chandler',
    'https://www.facebook.com/messages/t/robert.holweger',
    'https://www.facebook.com/messages/t/keifer.street',
    'https://www.facebook.com/messages/t/mynameisjane',
    'https://www.facebook.com/messages/t/ragunr',
    'https://www.facebook.com/messages/t/johan.larson.56',
    'https://www.facebook.com/messages/t/abe.pralle',
    'https://www.facebook.com/messages/t/crystaldgraziano',
    'https://www.facebook.com/messages/t/wolfdieter.otte',
    'https://www.facebook.com/messages/t/talbert.tso',
    'https://www.facebook.com/messages/t/abe.anwary',
    'https://www.facebook.com/messages/t/devin.west2',
    'https://www.facebook.com/messages/t/eurostar88',
    */
];

var tileWindows, jokes, windows, sendFacebookMessage, sendFacebookThanks;

function tellJokes() {
    // get multiple sets of 9 working for single page scraping in parallel
    return runSeleniumCell([
        'tile chrome windows',
        'log in facebook',
        'send facebook message',
        'send a joke',
        'list facebook threads',
        'scrape facebook profile',
        'messages from facebook',
        'send facebook thanks',
    ])
        .then(r =&gt; {
            tileWindows = r.tileWindows;
            sendFacebookMessage = r.sendFacebookMessage;
            sendJoke = r.sendJoke;
            listFacebookThreads = r.listFacebookThreads;
            sendFacebookThanks = r.sendFacebookThanks;
            return r.loginFacebook()
        })
        .then(() =&gt; listFacebookThreads())
        .then(r =&gt; {
            friends = r.slice(0, 100);
            console.log(friends);
        })
        .then(() =&gt; tileWindows(friends.slice(0, 3)))
        .then(windows =&gt; {
            var promises = [];
            for(var i = 0; i &lt; Math.ceil(friends.length / windows.length); i++) {
                promises = promises.concat((i =&gt; windows.map((hwnd, j) =&gt; resolve =&gt; {
                    return sendFacebookThanks(friends[i * windows.length + j], hwnd).catch(e =&gt; e).then(r =&gt; resolve(r));
                }))(i));
            }
            return importer.runAllPromises(promises);
        })
        .catch(e =&gt; console.log(e))
}

if(typeof $ !== 'undefined') {
    $.async();
    tellJokes()
        .then(r =&gt; $.sendResult(r))
        .catch(e =&gt; $.sendError(e))
}
</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="../../mergehtml.js"></script>

<script>
hljs.addPlugin(mergeHTMLPlugin);
hljs.highlightAll();
</script>

<div class="gold"><h2>What the code could have been:</h2>
<pre class="javascript"><code>const { RPC } = require('../Core');
const { runSeleniumCell } = RPC.import('selenium cell');

const friends = getFriends(); // Fetch friends list from a reliable source

// Refactored functions for better readability and maintainability
async function loginFacebook() {
    return await runSeleniumCell('login facebook');
}

async function listFacebookThreads() {
    return await runSeleniumCell('list facebook threads');
}

async function tileWindows(friends) {
    return await runSeleniumCell('tile chrome windows', friends);
}

async function sendFacebookMessage(friendUrl) {
    return await runSeleniumCell('send facebook message', friendUrl);
}

async function sendJoke(friendUrl) {
    return await runSeleniumCell('send a joke', friendUrl);
}

async function sendFacebookThanks(friendUrl, hwnd) {
    return await runSeleniumCell('send facebook thanks', friendUrl, hwnd);
}

async function tellJokes() {
    try {
        // Login to Facebook
        const loginResult = await loginFacebook();
        
        // Get friends list
        const friendsList = await listFacebookThreads();
        friends = friendsList.slice(0, 100);
        console.log(friends);

        // Tile windows for scrapes
        await tileWindows(friends.slice(0, 3));

        // Send thanks to friends in parallel
        const promises = [];
        for (let i = 0; i < Math.ceil(friends.length / 3); i++) {
            const hwnds = await tileWindows(friends.slice(i * 3, (i + 1) * 3));
            const hwndPromises = hwnds.map(hwnd => sendFacebookThanks(friends[i * 3], hwnd));
            promises.push(...hwndPromises);
        }
        await RPC.runAllPromises(promises);
    } catch (error) {
        console.error(error);
    }
}

// TODO: Replace getFriends with a reliable function to fetch friends list
function getFriends() {
    // For demonstration purposes, return a sample list of friends
    return [
        'https://www.facebook.com/messages/t/patti.caudill',
        'https://www.facebook.com/messages/t/andrei.darie.5',
        'https://www.facebook.com/messages/t/setha.vanderhoof',
        // Add more friends to the list as needed
    ];
}

if (typeof $!== 'undefined') {
    $.async();
    tellJokes()
       .then(result => $.sendResult(result))
       .catch(error => $.sendError(error));
}</code></pre></div><p><strong>Code Breakdown</strong></p>
<h3>Importing Modules</h3>
<pre><code class="language-javascript">var importer = require('../Core');
var runSeleniumCell = importer.import('selenium cell');
</code></pre>
<ul>
<li>The code imports a module named <code>Core</code> from a relative path (<code>../Core</code>).</li>
<li>It then imports a function named <code>selenium cell</code> from the imported <code>Core</code> module.</li>
</ul>
<h3>Friend URLs</h3>
<pre><code class="language-javascript">var friends = [
    'https://www.facebook.com/messages/t/patti.caudill',
    'https://www.facebook.com/messages/t/andrei.darie.5',
    'https://www.facebook.com/messages/t/setha.vanderhoof',
    /*... */
];
</code></pre>
<ul>
<li>The code defines an array of URLs to Facebook messages.</li>
<li>Each URL is in the format <code>https://www.facebook.com/messages/t/&lt;username&gt;</code>.</li>
<li>The array is incomplete, with many entries commented out.</li>
</ul>
<h3>TODO Comment</h3>
<pre><code class="language-javascript">// TODO: replace with rpc commands
</code></pre>
<ul>
<li>The code includes a TODO comment, indicating that the current implementation should be replaced with RPC (Remote Procedure Call) commands.</li>
</ul>

</body>

</html>