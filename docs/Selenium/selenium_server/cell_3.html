<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Cell 3</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    html {
      padding: 0;
      margin: 0;
    }

    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
      padding: 10px;
    }

    body {
      padding: 0 0 0 200px;
      margin: 0;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <h3><a href="../selenium_server/index.html">selenium server</a></h3>
    <a href="./Start_a_selenium_http_express_server.html">Start a selenium http express server</a>
<br /><br />
<a href="./cell_1.html">Cell 1</a>
<br /><br />
<a href="./cell_2.html">Cell 2</a>
<br /><br />
<a href="./cell_3.html">Cell 3</a>
<br /><br />
<a href="./cell_4.html">Cell 4</a>
<br /><br />
<a href="./cell_5.html">Cell 5</a>
<br /><br />
<a href="./cell_6.html">Cell 6</a>
<br /><br />

  </nav>
  <header>
    <a href="../selenium_server/index.html">selenium server</a> | <a href="./cell_2.html">Cell 2</a> | <a href="./cell_4.html">Cell 4</a> | <a href="../../search.html">Search</a>
  </header>

  <p>The <code>findElements</code> function uses the Chrome debugger API to find elements on a webpage based on an input selector, and is called by two express routes to handle POST requests. The function and express router are exported as part of the module, allowing it to be used in other applications.</p>
<h1>Cell 3</h1>



<pre class="javascript"><code>var express = require('express');
var router = express.Router();

function findElements(selector) {
    return promisifyChrome('debugger.sendCommand', {
        tabId: getTab()
    }, 'Runtime.evaluate', {
        expression: `new window.BackupPromise(resolve =&gt; setTimeout(() =&gt; {
resolve([].slice.call(window.document.querySelectorAll(${JSON.stringify(selector)}), 0)[0])
}, 500))`,
        awaitPromise: true
    })
        .then(r =&gt; {
            return promisifyChrome('debugger.sendCommand', {
                tabId: getTab()
            }, 'DOM.requestNode', {
                objectId: r.result.objectId
            })
        })
        .then(r =&gt; ({value: {ELEMENT: r.nodeId}}))
        .catch(e =&gt; console.log(e))
}

router.post('/session/:sessionId/element', (req, res) =&gt;
    response(res, findElements(req.body.value)));
router.post('/session/:sessionId/elements', (req, res) =&gt;
    response(res, findElements(req.body.value)));

module.exports = {
    findElements,
    router
}

</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>

<script>hljs.highlightAll();</script>

<p><strong>Code Breakdown</strong></p>
<h3>Requires and Dependencies</h3>
<ul>
<li><code>express</code> is required and an instance of an express router is created.</li>
</ul>
<h3>Function: <code>findElements(selector)</code></h3>
<ul>
<li>Returns elements found on a webpage using a Chrome debugger API.</li>
<li>Takes a <code>selector</code> as input, which is a string representing an HTML or CSS selector.</li>
<li>Uses <code>promisifyChrome</code> to send a command to the Chrome debugger to evaluate an expression.</li>
<li>The expression uses <code>window.BackupPromise</code> to resolve a promise that returns an array of elements matching the selector.</li>
<li>The function returns an object containing the node ID of the first matching element.</li>
</ul>
<h3>Express Router</h3>
<ul>
<li>Two routes are defined:
<ul>
<li><code>/session/:sessionId/element</code>: Handles a POST request to find a single element.</li>
<li><code>/session/:sessionId/elements</code>: Handles a POST request to find multiple elements.</li>
</ul></li>
<li>Both routes call the <code>findElements</code> function with the request body as an argument, and call the <code>response</code> function to send the result back to the client.</li>
</ul>
<h3>Module Exports</h3>
<ul>
<li>The <code>findElements</code> function and the express router are exported as part of the module.</li>
</ul>

</body>

</html>