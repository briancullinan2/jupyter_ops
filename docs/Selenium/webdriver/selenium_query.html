<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>selenium query</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
  <style>
    nav {
      position: fixed;
      overflow: auto;
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      width: 200px;
    }

    header {
      background-color: #EEE;
    }

    body {
      padding-left: 200px;
    }

    @media screen and (max-width: 600px) {
      body {
        padding-left: 0;
      }

      nav {
        display: none;
      }
    }
  </style>
</head>

<body>
  <nav>
    <a href="../webdriver/index.html">webdriver</a>
    <br /><br />
    <a href="./selenium_client.html">selenium client</a>
<br /><br />
<a href="./selenium_session.html">selenium session</a>
<br /><br />
<a href="./webdriver_test.html">webdriver test</a>
<br /><br />
<a href="./close_all_windows.html">close all windows</a>
<br /><br />
<a href="./selenium_executor.html">selenium executor</a>
<br /><br />
<a href="./list_sessions.html">list sessions</a>
<br /><br />
<a href="./selenium_select.html">selenium select</a>
<br /><br />
<a href="./selenium_query.html">selenium query</a>
<br /><br />
<a href="./cell_8.html">Cell 8</a>
<br /><br />
<a href="./cell_9.html">Cell 9</a>
<br /><br />
<a href="./cell_10.html">Cell 10</a>
<br /><br />
<a href="./cell_11.html">Cell 11</a>
<br /><br />
<a href="./cell_12.html">Cell 12</a>
<br /><br />
<a href="./cell_13.html">Cell 13</a>
<br /><br />
<a href="./cell_14.html">Cell 14</a>
<br /><br />
<a href="./cell_15.html">Cell 15</a>
<br /><br />
<a href="./cell_16.html">Cell 16</a>
<br /><br />
<a href="./cell_17.html">Cell 17</a>
<br /><br />

  </nav>
  <header>
    <a href="../webdriver/index.html">webdriver</a> ${PREV} ${NEXT}
  </header>

  <p>Here's a two-sentence summary of the code breakdown:</p>
<p>The <code>getAllQuery</code> function is defined as an asynchronous function that executes a script in a browser context using the <code>driver.executeScript</code> method, which involves importing and utilizing external functions for querying and evaluating the DOM. The function takes three parameters - <code>driver</code>, <code>select</code>, and an optional <code>ctx</code> object - and returns the result of executing the <code>queryDom</code> function.</p>


<pre class="javascript"><code>
const {queryDom, evaluateDom} = importer.import('select tree')
const {walkTree} = importer.import('walk tree')

async function getAllQuery(driver, select, ctx) {
  return await driver.executeScript((
    function main(evaluateDomString, walkTreeString, queryDomString, select, ctx) {
      if(!window.evaluateDom)
        window.evaluateDom = eval('(' + evaluateDomString + ')')
      if(!window.walkTree)
        window.walkTree = eval('(' + walkTreeString + ')')
      if(!window.queryDom)
        window.queryDom = eval('(' + queryDomString + ')')
      let result = queryDom(select, ctx || document)
      return result;
    }), evaluateDom, walkTree, queryDom, select, ctx)
}

module.exports = getAllQuery
</code></pre>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>

<script>hljs.highlightAll();</script>

<p><strong>Code Breakdown</strong></p>
<h3>Importing Dependencies</h3>
<p>The code starts by importing two functions from external modules:</p>
<ul>
<li><code>queryDom</code> and <code>evaluateDom</code> from the <code>'select tree'</code> module</li>
<li><code>walkTree</code> from the <code>'walk tree'</code> module</li>
</ul>
<pre><code class="language-javascript">const {queryDom, evaluateDom} = importer.import('select tree')
const {walkTree} = importer.import('walk tree')
</code></pre>
<h3>Defining the <code>getAllQuery</code> Function</h3>
<p>The <code>getAllQuery</code> function is defined as an asynchronous function that takes three parameters:</p>
<ul>
<li><code>driver</code>: an object with an <code>executeScript</code> method</li>
<li><code>select</code>: an object or string to be used in the <code>queryDom</code> function</li>
<li><code>ctx</code>: an optional context object</li>
</ul>
<pre><code class="language-javascript">async function getAllQuery(driver, select, ctx) {
 ...
}
</code></pre>
<h3>Executing Script in Browser Context</h3>
<p>The function executes a script in a browser context using the <code>driver.executeScript</code> method. The script defines a <code>main</code> function that:</p>
<ul>
<li>Checks if <code>window.evaluateDom</code>, <code>window.walkTree</code>, and <code>window.queryDom</code> are defined, and if not, sets them to the imported functions using <code>eval</code>.</li>
<li>Calls the <code>queryDom</code> function with the provided <code>select</code> and <code>ctx</code> (or <code>document</code> if <code>ctx</code> is not provided), and returns the result.</li>
</ul>
<pre><code class="language-javascript">driver.executeScript((
  function main(evaluateDomString, walkTreeString, queryDomString, select, ctx) {
   ...
    let result = queryDom(select, ctx || document)
    return result;
  }), evaluateDom, walkTree, queryDom, select, ctx)
</code></pre>
<h3>Exporting the Function</h3>
<p>The <code>getAllQuery</code> function is exported as a module.</p>
<pre><code class="language-javascript">module.exports = getAllQuery
</code></pre>

</body>

</html>